<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>an:care Community</title>
  <meta name="description" content="Community Bereich mit Feed, Likes, Kommentaren, Kalender und Meetings. Prototyp, lokal im Browser gespeichert." />
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="favicon.png">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header>
    <div class="container">
      <div class="nav">
        <a class="brand" href="index.html" aria-label="Start">
          <img class="logo" src="logo-v2.jpg" alt="an:care Logo" />
          <span>
            an:care
            <small>Community</small>
          </span>
        </a>

        <nav class="links" aria-label="Navigation">
          <a class="link" href="shop.html">Shop</a>
          <a class="link" href="community.html">Community</a>
          <a class="link" href="marketing.html">Marketing</a>
          <a class="link" href="podcast.html">Podcast</a>
          <a class="link" href="blog.html">Blog</a>
          <a class="btn btnPrimary" href="product.html">
            Zum Produkt <span class="badge" id="cartCount">0</span>
          </a>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="container">

        <div class="card shadowBig">
          <div class="padLg">
            <div class="kicker"><span class="dot" aria-hidden="true"></span> Community</div>
            <h1 style="margin:10px 0">Feed, Kalender und Meetings</h1>
            <p class="lead" style="margin:0">
              Prototyp: Austausch, Workshops, Sessions. Alles wird lokal im Browser gespeichert.
            </p>
            <div class="ctaRow" style="margin-top:14px">
              <button class="btn btnPrimary" type="button" id="loadExamples">Beispiele laden</button>
              <button class="btn" type="button" id="clearAll">Alles l√∂schen</button>
            </div>
          </div>
        </div>

        <div style="height:18px"></div>

        <div class="card shadowBig" style="margin-bottom:18px">
          <div class="mediaTop">
            <div>
              <strong>Community Feed</strong><br />
              <span>Austausch, Gedanken, Erfahrungen</span>
            </div>
            <span class="kicker" style="margin:0">Live</span>
          </div>

          <div class="pad">
            <div class="card" style="background:rgba(255,255,255,.7)">
              <div class="pad">
                <div style="font-weight:900; font-size:16px">Neuen Beitrag erstellen</div>

                <div class="field">
                  <label for="postAuthor">Name</label>
                  <input id="postAuthor" type="text" placeholder="Dein Name" />
                </div>

                <div class="field">
                  <label for="postContent">Beitrag</label>
                  <input id="postContent" type="text" placeholder="Was m√∂chtest du teilen?" />
                </div>

                <div class="ctaRow" style="margin-top:12px">
                  <button class="btn btnPrimary" type="button" id="addPost">Ver√∂ffentlichen</button>
                </div>

                <div class="fineprint" style="margin-top:12px">
                  Hinweis: Im Prototyp sind Likes und Kommentare lokal gespeichert (kein Login, kein Backend).
                </div>
              </div>
            </div>

            <div style="height:18px"></div>

            <div id="communityFeed"></div>
          </div>
        </div>

        <div class="grid2">
          <div class="card shadowBig">
            <div class="mediaTop">
              <div>
                <strong>Kalender</strong><br />
                <span id="monthLabel">Monat</span>
              </div>
              <div class="ctaRow" style="margin:0">
                <button class="btn btnSmall" type="button" id="prevMonth">Zur√ºck</button>
                <button class="btn btnSmall" type="button" id="nextMonth">Weiter</button>
              </div>
            </div>

            <div class="pad">
              <div class="calendarGrid" aria-label="Kalender">
                <div class="calHead">Mo</div><div class="calHead">Di</div><div class="calHead">Mi</div><div class="calHead">Do</div><div class="calHead">Fr</div><div class="calHead">Sa</div><div class="calHead">So</div>
                <div id="calendarCells" class="calCells"></div>
              </div>

              <div class="fineprint">
                Tipp: Klicke einen Tag an, um das Formular automatisch zu f√ºllen.
              </div>
            </div>
          </div>

          <div class="card shadowBig">
            <div class="mediaTop">
              <div>
                <strong>Meetings</strong><br />
                <span>Geplante Sessions und Workshops</span>
              </div>
              <span class="kicker" style="margin:0">Prototyp</span>
            </div>

            <div class="pad">
              <div id="meetingsList"></div>
              <div style="height:14px"></div>

              <div class="card" style="background:rgba(255,255,255,.7)">
                <div class="pad">
                  <div style="font-weight:900; font-size:16px">Meeting hinzuf√ºgen</div>

                  <div class="field">
                    <label for="mTitle">Titel</label>
                    <input id="mTitle" type="text" placeholder="Zum Beispiel: 10 Minuten Reset Session" />
                  </div>

                  <div class="field">
                    <label for="mDate">Datum</label>
                    <input id="mDate" type="date" />
                  </div>

                  <div class="field" style="display:grid; grid-template-columns: 1fr 1fr; gap:12px">
                    <div>
                      <label for="mTime">Uhrzeit</label>
                      <input id="mTime" type="time" />
                    </div>
                    <div>
                      <label for="mDuration">Dauer Minuten</label>
                      <input id="mDuration" type="number" min="5" value="30" />
                    </div>
                  </div>

                  <div class="field">
                    <label for="mPlace">Ort oder Link</label>
                    <input id="mPlace" type="text" placeholder="Zoom Link oder Ort" />
                  </div>

                  <div class="ctaRow" style="margin-top:14px">
                    <button class="btn btnPrimary" type="button" id="addMeeting">Meeting speichern</button>
                    <button class="btn" type="button" id="resetForm">Zur√ºcksetzen</button>
                  </div>

                  <div class="fineprint" style="margin-top:12px">
                    Hinweis: Das ist ein Prototyp. Sp√§ter kann das an echte Kalender Systeme angebunden werden.
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

      </div>
    </section>

    <footer>
      <div class="container">
        <div class="foot">
          <div>
            <strong style="color:var(--text)">an:care</strong><br />
            <span>Prototyp f√ºr Konzepttests und Feedback</span>
          </div>

          <div style="display:flex; gap:16px; flex-wrap:wrap;">
            <a class="link" href="FAQ.html">FAQ</a>
            <a class="link" href="impressum.html">Impressum</a>
            <a class="link" href="datenschutz.html">Datenschutz</a>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <!-- Cache Bust, damit GitHub Pages wirklich die neue app.js nimmt -->
  <script src="app.js?v=20260208"></script>

  <script>
    // Mini Debug: du siehst sofort, ob app.js geladen ist
    document.addEventListener("DOMContentLoaded", () => {
      console.log("[community] DOMContentLoaded");
      console.log("[community] setCartBadge exists:", typeof setCartBadge);
      if (typeof setCartBadge === "function") setCartBadge();
    });

    const MEETINGS_KEY = "ancare_meetings_v1";
    const POSTS_KEY = "ancare_posts_v1";

    function safeParse(str, fallback) {
      try { return JSON.parse(str); } catch { return fallback; }
    }
    function pad2(n){ return String(n).padStart(2, "0"); }
    function toISODate(d){
      return d.getFullYear() + "-" + pad2(d.getMonth()+1) + "-" + pad2(d.getDate());
    }

    function loadMeetings() {
      return safeParse(localStorage.getItem(MEETINGS_KEY) || "[]", []);
    }
    function saveMeetings(list) {
      localStorage.setItem(MEETINGS_KEY, JSON.stringify(list));
    }

    function renderMeetings() {
      const host = document.getElementById("meetingsList");
      const list = loadMeetings();

      list.sort((a,b) => (a.date + (a.time||"")).localeCompare(b.date + (b.time||"")));

      if (list.length === 0) {
        host.innerHTML = `<div class="sub">Noch keine Meetings geplant.</div>`;
        return;
      }

      host.innerHTML = list.map((m, idx) => {
        const when = `${m.date}${m.time ? " ¬∑ " + m.time : ""}`;
        const dur = m.duration ? ` ¬∑ ${m.duration} min` : "";
        const place = m.place ? `<div class="sub" style="margin-top:6px">${m.place}</div>` : "";
        return `
          <div class="meetingItem">
            <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start">
              <div style="min-width:0">
                <div style="font-weight:900">${m.title || "Meeting"}</div>
                <div class="sub" style="margin-top:4px">${when}${dur}</div>
                ${place}
              </div>
              <button class="btn btnSmall" type="button" data-del-meeting="${idx}">L√∂schen</button>
            </div>
          </div>
        `;
      }).join("");

      host.querySelectorAll("[data-del-meeting]").forEach(btn => {
        btn.addEventListener("click", () => {
          const i = parseInt(btn.getAttribute("data-del-meeting"), 10);
          const next = loadMeetings();
          next.splice(i, 1);
          saveMeetings(next);
          renderMeetings();
          renderMonth();
        });
      });
    }

    function resetMeetingForm() {
      document.getElementById("mTitle").value = "";
      document.getElementById("mDate").value = "";
      document.getElementById("mTime").value = "";
      document.getElementById("mDuration").value = "30";
      document.getElementById("mPlace").value = "";
    }

    document.getElementById("addMeeting").addEventListener("click", () => {
      const title = (document.getElementById("mTitle").value || "").trim();
      const date = document.getElementById("mDate").value;
      const time = document.getElementById("mTime").value;
      const duration = parseInt(document.getElementById("mDuration").value || "30", 10);
      const place = (document.getElementById("mPlace").value || "").trim();

      if (!date) { alert("Bitte Datum w√§hlen."); return; }
      if (!title) { alert("Bitte Titel eingeben."); return; }

      const list = loadMeetings();
      list.push({
        id: "m_" + Date.now(),
        title,
        date,
        time,
        duration: Math.max(5, isNaN(duration) ? 30 : duration),
        place
      });
      saveMeetings(list);

      renderMeetings();
      renderMonth();
      resetMeetingForm();
      alert("Meeting gespeichert (Prototyp).");
    });

    document.getElementById("resetForm").addEventListener("click", resetMeetingForm);

    let viewDate = new Date();

    function renderMonth() {
      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();

      const label = new Intl.DateTimeFormat("de-DE", { month: "long", year: "numeric" }).format(new Date(year, month, 1));
      document.getElementById("monthLabel").textContent = label;

      const cellsHost = document.getElementById("calendarCells");
      cellsHost.innerHTML = "";

      const first = new Date(year, month, 1);
      const weekday = (first.getDay() + 6) % 7;
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let i = 0; i < weekday; i++) {
        const empty = document.createElement("button");
        empty.className = "calCell calMuted";
        empty.type = "button";
        empty.disabled = true;
        empty.textContent = "";
        cellsHost.appendChild(empty);
      }

      const meetings = loadMeetings();
      const todayISO = toISODate(new Date());

      for (let day = 1; day <= daysInMonth; day++) {
        const d = new Date(year, month, day);
        const iso = toISODate(d);

        const count = meetings.filter(m => m.date === iso).length;

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "calCell";
        if (iso === todayISO) btn.classList.add("calToday");
        if (count > 0) btn.classList.add("calHas");

        btn.innerHTML = `
          <div class="calNum">${day}</div>
          ${count > 0 ? `<div class="calBadge">${count}</div>` : ``}
        `;

        btn.addEventListener("click", () => {
          document.getElementById("mDate").value = iso;
          document.getElementById("mTitle").focus();
        });

        cellsHost.appendChild(btn);
      }
    }

    document.getElementById("prevMonth").addEventListener("click", () => {
      viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1);
      renderMonth();
    });
    document.getElementById("nextMonth").addEventListener("click", () => {
      viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1);
      renderMonth();
    });

    function loadPosts() {
      return safeParse(localStorage.getItem(POSTS_KEY) || "[]", []);
    }
    function savePosts(posts) {
      localStorage.setItem(POSTS_KEY, JSON.stringify(posts));
    }

    function renderPosts() {
      const host = document.getElementById("communityFeed");
      const posts = loadPosts();

      if (posts.length === 0) {
        host.innerHTML = `<div class="sub">Noch keine Beitr√§ge vorhanden.</div>`;
        return;
      }

      host.innerHTML = posts.map((p, idx) => {
        const dateStr = new Date(p.ts).toLocaleDateString("de-DE");
        const comments = (p.comments || []).map(c =>
          `<div class="sub" style="margin-top:6px; padding-left:12px">‚Ä¢ ${c}</div>`
        ).join("");

        return `
          <div class="postItem">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px">
              <div style="min-width:0">
                <div style="font-weight:900">${p.author || "Community"}</div>
                <div class="sub" style="margin-top:4px">${p.content || ""}</div>
              </div>
              <div class="sub" style="white-space:nowrap">${dateStr}</div>
            </div>

            <div class="ctaRow" style="margin-top:10px">
              <button class="btn btnSmall" type="button" data-like="${idx}">‚ù§Ô∏è ${p.likes || 0}</button>
              <button class="btn btnSmall" type="button" data-toggle-comments="${idx}">üí¨ ${(p.comments || []).length}</button>
              <button class="btn btnSmall" type="button" data-del-post="${idx}">L√∂schen</button>
            </div>

            <div class="commentsArea" id="comments-${idx}" style="margin-top:10px; display:none">
              ${comments || `<div class="sub" style="opacity:.8">Noch keine Kommentare.</div>`}

              <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
                <input class="commentInput" type="text" id="commentInput-${idx}" placeholder="Kommentar schreiben..." />
                <button class="btn btnSmall" type="button" data-submit-comment="${idx}">Senden</button>
              </div>
            </div>
          </div>
        `;
      }).join("");

      host.querySelectorAll("[data-like]").forEach(btn => {
        btn.addEventListener("click", () => {
          const i = parseInt(btn.getAttribute("data-like"), 10);
          const posts = loadPosts();
          posts[i].likes = (posts[i].likes || 0) + 1;
          savePosts(posts);
          renderPosts();
        });
      });

      host.querySelectorAll("[data-toggle-comments]").forEach(btn => {
        btn.addEventListener("click", () => {
          const i = btn.getAttribute("data-toggle-comments");
          const area = document.getElementById("comments-" + i);
          area.style.display = area.style.display === "none" ? "block" : "none";
        });
      });

      host.querySelectorAll("[data-submit-comment]").forEach(btn => {
        btn.addEventListener("click", () => {
          const i = parseInt(btn.getAttribute("data-submit-comment"), 10);
          const input = document.getElementById("commentInput-" + i);
          const text = (input.value || "").trim();
          if (!text) return;

          const posts = loadPosts();
          posts[i].comments = posts[i].comments || [];
          posts[i].comments.push(text);
          savePosts(posts);
          renderPosts();
        });
      });

      host.querySelectorAll("[data-del-post]").forEach(btn => {
        btn.addEventListener("click", () => {
          const i = parseInt(btn.getAttribute("data-del-post"), 10);
          const posts = loadPosts();
          posts.splice(i, 1);
          savePosts(posts);
          renderPosts();
        });
      });
    }

    document.getElementById("addPost").addEventListener("click", () => {
      const author = (document.getElementById("postAuthor").value || "").trim();
      const content = (document.getElementById("postContent").value || "").trim();

      if (!author || !content) {
        alert("Bitte Name und Beitrag eingeben.");
        return;
      }

      const posts = loadPosts();
      posts.unshift({
        id: "p_" + Date.now(),
        author,
        content,
        ts: new Date().toISOString(),
        likes: 0,
        comments: []
      });

      savePosts(posts);
      document.getElementById("postAuthor").value = "";
      document.getElementById("postContent").value = "";
      renderPosts();
    });

    document.getElementById("loadExamples").addEventListener("click", () => {
      const now = new Date();
      const y = now.getFullYear();
      const m = now.getMonth();

      const examplesMeetings = [
        { id:"m1", title:"Community Reset Session", date: toISODate(new Date(y,m, Math.min(28, now.getDate()+2))), time:"19:00", duration:30, place:"Online ¬∑ Zoom Link" },
        { id:"m2", title:"Austausch Runde: Stress reduzieren", date: toISODate(new Date(y,m, Math.min(28, now.getDate()+5))), time:"18:30", duration:45, place:"Online ¬∑ Zoom Link" },
        { id:"m3", title:"Mini Ritual Workshop", date: toISODate(new Date(y,m, Math.min(28, now.getDate()+9))), time:"20:00", duration:40, place:"Online ¬∑ Zoom Link" },
      ];
      saveMeetings(examplesMeetings);

      const examplesPosts = [
        { id:"p1", author:"Mara", content:"Ich habe an:care heute vor einem Termin genutzt und war direkt ruhiger.", ts:new Date(Date.now()-86400000*2).toISOString(), likes:2, comments:["Klingt stark. Welche Sorte?","Ich brauche das auch f√ºr Termine."] },
        { id:"p2", author:"Jonas", content:"Mini Ritual am Abend: 4 Atemz√ºge + Fokus auf Ausatmen. Hilft mir total.", ts:new Date(Date.now()-86400000*1).toISOString(), likes:5, comments:["Danke f√ºrs Teilen!"] },
        { id:"p3", author:"Lea", content:"W√ºrde gerne eine kurze Live Session testen. Wer w√§re dabei?", ts:new Date().toISOString(), likes:1, comments:[] },
      ];
      savePosts(examplesPosts);

      renderMeetings();
      renderMonth();
      renderPosts();

      alert("Beispiele geladen.");
    });

    document.getElementById("clearAll").addEventListener("click", () => {
      localStorage.removeItem(MEETINGS_KEY);
      localStorage.removeItem(POSTS_KEY);
      renderMeetings();
      renderMonth();
      renderPosts();
      alert("Alles gel√∂scht (Prototyp).");
    });

    renderMonth();
    renderMeetings();
    renderPosts();
  </script>
</body>
</html>

